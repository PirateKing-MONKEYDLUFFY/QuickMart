<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Address - QuickMart</title>
    <link rel="stylesheet" href="css/media.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .address-container {
            max-width: 800px;
            margin: 30px auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .address-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-title {
            grid-column: 1 / -1;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea {
            height: 80px;
            resize: vertical;
        }

        .saved-addresses {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .address-card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .default-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #2E9E44;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }

        .address-actions {
            margin-top: 10px;
        }

        .btn-action {
            background: none;
            border: none;
            color: #00bcd4;
            cursor: pointer;
            font-size: 14px;
            margin-right: 15px;
        }

        .btn-submit {
            background-color: #FDCB02;
            color: #333;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.3s;
        }

        .btn-submit:hover {
            background-color: #2E9E44;
            color: white;
        }
        
        .delivery-timing {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid #FDCB02;
        }
        
        .location-btn {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .location-btn i {
            margin-right: 5px;
        }
        
        .location-btn:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>

<body>
    <header>
        <div class="headerLeft">
            <div class="logo">
                <a href="home.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="300" height="100" viewBox="0 0 300 100">
                        <text x="0" y="70" font-family="Arial, sans-serif" font-size="60">
                            <tspan fill="#FDCB02">Quick</tspan>
                            <tspan fill="#2E9E44">Mart</tspan>
                        </text>
                    </svg>
                </a>
            </div>

            <div class="headerAddress">
                <h3>Delivery in 8 minutes</h3>
                <p>Set your delivery location</p>
            </div>
        </div>

        <form class="searchBox">
            <button><i class="fa-solid fa-magnifying-glass"></i></button>
            <input type="text" />
        </form>

        <div class="headerBtn">
            <div id="userDropdown" class="dropdown" style="display: none; position: relative;">
                <button class="dropbtn" id="welcomeUser" style="font-weight: bold;">Welcome</button>
                <div class="dropdown-content" id="dropdownContent"
                    style="display: none; position: absolute; right: 0; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); min-width: 160px; z-index: 1001;">
                    <a href="VendorDashboard.html">üè† Go to Dashboard</a> 
                    <a href="#" id="logoutBtn">‚ùå Logout</a>
                </div>
            </div>

            <button id="loginBtn" style="cursor: pointer;">Login</button>
            <button onclick="window.location.href='Cart.html'" style="cursor: pointer;">
                <i class="fa-solid fa-cart-shopping"></i> &nbsp; My Cart
            </button>
        </div>
    </header>

    <div class="address-container">
        <div class="form-title">
            <h2>Delivery Address</h2>
            <p>Add a new delivery address or select from your saved addresses</p>
        </div>
        
        <div class="delivery-timing">
            <h3><i class="fa-solid fa-clock"></i> Delivery Time</h3>
            <p>Expected delivery within 8 minutes of order confirmation to this address</p>
        </div>

        <form id="addressForm" class="address-form">
            <div class="form-group">
                <label for="fullName">Full Name*</label>
                <input type="text" id="fullName" name="fullName" required>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number*</label>
                <input type="tel" id="phone" name="phone" pattern="[0-9]{10}" placeholder="10-digit mobile number" required>
            </div>

            <div class="form-group">
                <label for="pincode">Pincode*</label>
                <input type="text" id="pincode" name="pincode" pattern="[0-9]{6}" placeholder="6-digit pincode" required>
            </div>

            <div class="form-group">
                <label for="locality">Locality/Area*</label>
                <input type="text" id="locality" name="locality" required>
            </div>

            <div class="form-group full-width">
                <label for="address">Address (House No, Building, Street)*</label>
                <textarea id="address" name="address" required></textarea>
            </div>

            <div class="form-group">
                <label for="city">City/District*</label>
                <input type="text" id="city" name="city" required>
            </div>

            <div class="form-group">
                <label for="state">State*</label>
                <select id="state" name="state" required>
                    <option value="">Select State</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                </select>
            </div>

            <div class="form-group">
                <label for="addressType">Address Type*</label>
                <select id="addressType" name="addressType" required>
                    <option value="home">Home</option>
                    <option value="work">Work</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="landmark">Landmark (Optional)</label>
                <input type="text" id="landmark" name="landmark" placeholder="Landmark for easier navigation">
            </div>

            <div class="form-group full-width">
                <button type="button" class="location-btn" id="currentLocationBtn">
                    <i class="fa-solid fa-location-crosshairs"></i> Use Current Location
                </button>
            </div>

            <div class="form-group full-width">
                <button type="submit" class="btn-submit">Save Address & Proceed</button>
            </div>
        </form>

        <div class="saved-addresses">
            <h3>Saved Addresses</h3>
            <div id="addressList">
                <!-- Sample saved address -->
                <div class="address-card">
                    <span class="default-badge">Default</span>
                    <h4>Home</h4>
                    <p>John Doe</p>
                    <p>123 Main Street, Green Park</p>
                    <p>New Delhi, Delhi - 110016</p>
                    <p>Phone: 9876543210</p>
                    <div class="address-actions">
                        <button class="btn-action" onclick="editAddress(1)">Edit</button>
                        <button class="btn-action" onclick="deleteAddress(1)">Delete</button>
                        <button class="btn-action" onclick="setDefaultAddress(1)">Set as Default</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to handle form submission
        document.getElementById('addressForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            const addressData = {};
            
            for (let [key, value] of formData.entries()) {
                addressData[key] = value;
            }
            
            // Save to localStorage
            saveAddress(addressData);
            
            // Show success message
            alert('Address saved successfully!');
            
            // Mark that the user has set their location
            sessionStorage.setItem("locationPromptShown", "true");
            
            // Redirect to cart or checkout page
            // Check if they were redirected from the first login flow
            if (sessionStorage.getItem("fromFirstLogin")) {
                sessionStorage.removeItem("fromFirstLogin");
                window.location.href = 'home.html';
            } else {
                window.location.href = 'Cart.html';
            }
        });
        
        // Function to update the default address for display in the header
        function updateDefaultAddressForHeader() {
            const addresses = JSON.parse(localStorage.getItem('customerAddresses')) || [];
            const defaultAddress = addresses.find(addr => addr.isDefault);
            
            if (defaultAddress) {
                // Format a short version of the address for the header
                const shortAddress = `${defaultAddress.locality}, ${defaultAddress.city}`;
                localStorage.setItem('displayAddress', shortAddress);
            }
        }
        
        // Function to save address to localStorage
        function saveAddress(addressData) {
            // Get existing addresses from localStorage
            let addresses = JSON.parse(localStorage.getItem('customerAddresses')) || [];
            
            // Add the new address
            addressData.id = Date.now(); // Use timestamp as ID
            
            // If this is the first address, set it as default
            if (addresses.length === 0) {
                addressData.isDefault = true;
            } else {
                addressData.isDefault = false;
            }
            
            addresses.push(addressData);
            
            // Save back to localStorage
            localStorage.setItem('customerAddresses', JSON.stringify(addresses));
            
            // Update the default address for header display
            updateDefaultAddressForHeader();
            
            // Update the address display
            displaySavedAddresses();
        }
        
        // Function to display saved addresses
        function displaySavedAddresses() {
            const addressList = document.getElementById('addressList');
            addressList.innerHTML = '';
            
            // Get addresses from localStorage
            const addresses = JSON.parse(localStorage.getItem('customerAddresses')) || [];
            
            if (addresses.length === 0) {
                addressList.innerHTML = '<p>No saved addresses yet.</p>';
                return;
            }
            
            // Display each address
            addresses.forEach(address => {
                const addressCard = document.createElement('div');
                addressCard.className = 'address-card';
                
                if (address.isDefault) {
                    const defaultBadge = document.createElement('span');
                    defaultBadge.className = 'default-badge';
                    defaultBadge.textContent = 'Default';
                    addressCard.appendChild(defaultBadge);
                }
                
                addressCard.innerHTML += `
                    <h4>${address.addressType.charAt(0).toUpperCase() + address.addressType.slice(1)}</h4>
                    <p>${address.fullName}</p>
                    <p>${address.address}, ${address.locality}</p>
                    <p>${address.city}, ${address.state} - ${address.pincode}</p>
                    <p>Phone: ${address.phone}</p>
                    <div class="address-actions">
                        <button class="btn-action" onclick="editAddress(${address.id})">Edit</button>
                        <button class="btn-action" onclick="deleteAddress(${address.id})">Delete</button>
                        ${!address.isDefault ? `<button class="btn-action" onclick="setDefaultAddress(${address.id})">Set as Default</button>` : ''}
                    </div>
                `;
                
                addressList.appendChild(addressCard);
            });
        }
        
        // Function to edit an address
        function editAddress(id) {
            // Get addresses from localStorage
            const addresses = JSON.parse(localStorage.getItem('customerAddresses')) || [];
            
            // Find the address with the given ID
            const address = addresses.find(addr => addr.id === id);
            
            if (!address) return;
            
            // Fill the form with the address data
            document.getElementById('fullName').value = address.fullName;
            document.getElementById('phone').value = address.phone;
            document.getElementById('pincode').value = address.pincode;
            document.getElementById('locality').value = address.locality;
            document.getElementById('address').value = address.address;
            document.getElementById('city').value = address.city;
            document.getElementById('state').value = address.state;
            document.getElementById('addressType').value = address.addressType;
            document.getElementById('landmark').value = address.landmark || '';
            
            // Scroll to the form
            document.querySelector('.address-form').scrollIntoView({ behavior: 'smooth' });
            
            // Update form submission to update instead of add
            const form = document.getElementById('addressForm');
            form.onsubmit = function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(this);
                const updatedAddress = {};
                
                for (let [key, value] of formData.entries()) {
                    updatedAddress[key] = value;
                }
                
                // Keep the ID and default status
                updatedAddress.id = id;
                updatedAddress.isDefault = address.isDefault;
                
                // Update the address in localStorage
                const updatedAddresses = addresses.map(addr => {
                    if (addr.id === id) {
                        return updatedAddress;
                    }
                    return addr;
                });
                
                localStorage.setItem('customerAddresses', JSON.stringify(updatedAddresses));
                
                // Show success message
                alert('Address updated successfully!');
                
                // Reset form and its submission handler
                form.reset();
                form.onsubmit = null;
                
                // Update the address display
                displaySavedAddresses();
                
                // Reload page to reset form submission handler
                window.location.reload();
            };
        }
        
        // Function to delete an address
        function deleteAddress(id) {
            if (!confirm('Are you sure you want to delete this address?')) return;
            
            // Get addresses from localStorage
            let addresses = JSON.parse(localStorage.getItem('customerAddresses')) || [];
            
            // Find the address with the given ID
            const address = addresses.find(addr => addr.id === id);
            
            if (!address) return;
            
            // Remove the address
            addresses = addresses.filter(addr => addr.id !== id);
            
            // If the deleted address was the default, set a new default
            if (address.isDefault && addresses.length > 0) {
                addresses[0].isDefault = true;
            }
            
            // Save back to localStorage
            localStorage.setItem('customerAddresses', JSON.stringify(addresses));
            
            // Update the address display
            displaySavedAddresses();
        }
        
        // Function to set an address as default
        function setDefaultAddress(id) {
            // Get addresses from localStorage
            let addresses = JSON.parse(localStorage.getItem('customerAddresses')) || [];
            
            // Update default status
            addresses = addresses.map(addr => {
                addr.isDefault = addr.id === id;
                return addr;
            });
            
            // Save back to localStorage
            localStorage.setItem('customerAddresses', JSON.stringify(addresses));
            
            // Update the default address for header display
            updateDefaultAddressForHeader();
            
            // Update the address display
            displaySavedAddresses();
        }
        
        // Get current location
        document.getElementById('currentLocationBtn').addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    // Here you would typically use a geolocation service API
                    // to convert the coordinates to an address
                    alert('Location detected! In a real app, we would fetch your address details.');
                    
                    // For demo purposes, we'll show the coordinates
                    console.log('Latitude: ' + position.coords.latitude);
                    console.log('Longitude: ' + position.coords.longitude);
                    
                    // In a real app, you would call a reverse geocoding API
                    // Example (pseudo-code):
                    // const address = getAddressFromCoordinates(position.coords.latitude, position.coords.longitude);
                    // document.getElementById('address').value = address.street;
                    // document.getElementById('city').value = address.city;
                    // etc.
                    
                    // For demo purposes, let's pre-fill some fields
                    document.getElementById('locality').value = 'Current Location Area';
                    document.getElementById('city').value = 'Current City';
                    document.getElementById('state').value = 'Delhi';
                    document.getElementById('address').value = 'Auto-detected location';
                    
                }, function(error) {
                    alert('Error getting location: ' + error.message);
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });
        
        // Load saved addresses when the page loads
        window.addEventListener('DOMContentLoaded', function() {
            displaySavedAddresses();
            updateDefaultAddressForHeader();
            
            // Check if user is logged in and update header
            if (localStorage.getItem("isLoggedIn") === "true") {
                document.getElementById('loginBtn').style.display = "none";
                const username = localStorage.getItem("userName");
                document.getElementById('welcomeUser').textContent = "Welcome, " + username + " ‚åÑ";
                document.getElementById('userDropdown').style.display = "inline-block";
            }
            
            // Check if we came from the first login flow
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('firstLogin') === 'true') {
                sessionStorage.setItem("fromFirstLogin", "true");
            }
        });
        
        // User dropdown functionality
        document.getElementById('welcomeUser').addEventListener('click', function() {
            const dropdown = document.getElementById('dropdownContent');
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        });
        
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("userName");
            localStorage.removeItem("userRole");
            window.location.href = 'home.html';
        });
    </script>
</body>

</html> 